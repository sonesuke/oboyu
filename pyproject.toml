[project]
name = "oboyu"
version = "0.1.0"
description = "A Japanese-enhanced semantic search system for your local documents."
readme = "README.md"
authors = [
    { name = "sonesuke", email = "iamsonesuke@gmail.com" }
]
requires-python = ">=3.13"
dependencies = [
    "chardet>=5.2.0",
    "charset-normalizer>=3.3.2",
    "langdetect>=1.0.9",
    "transformers>=4.48.0",
    "sentence-transformers",
    "torch",
    "duckdb>=0.9.0",  # Version supporting VSS extension
    "duckdb-engine",
    "protobuf>=4.25.1",  # Required for SentenceTransformer with Ruri model
    "sentencepiece>=0.2.0"  # Required for Japanese tokenization
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[dependency-groups]
dev = [
    "mypy>=1.15.0",
    "pre-commit>=4.2.0",
    "pytest>=8.3.5",
    "pytest-cov>=6.1.1",
    "ruff>=0.11.10",
]

[tool.mypy]
files = ["src"]
strict = true
disable_error_code = ["import-untyped"]

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["src"]
python_files = ["test_*.py", "*_test.py"]

[tool.coverage.run]
omit = []

[tool.ruff]
exclude = [".venv", "tests"]
target-version = "py313"
include = ["*.py"]
line-length = 120

[tool.ruff.lint]
select = [
  "C9",  # McCabe complexity
  "ANN",  # Type annotations
  "S",    # Security
  "E",    # Syntax errors
  "F",    # Pyflakes
  "W",    # Warnings
  "I",    # isort
  "D",    # Docstrings
]
ignore = [
  "D203",  # one-blank-line-before-class (we're using D211 instead)
  "D213",  # multi-line-summary-second-line (we're using D212 instead)
  "S608",  # Possible SQL injection vector through string-based query construction (we're using duckdb in-process. It doen't accept user input.)
]

[tool.ruff.lint.isort]
combine-as-imports = true
known-first-party = ["oboyu"]
split-on-trailing-comma = true

[tool.ruff.format]
quote-style = "double"

[tool.ruff.lint.mccabe]
max-complexity = 20